import{Q as U}from"./QSpace.ab43215f.js";import{a as D,Q as f}from"./QTable.e3b07091.js";import{q as w,r as P,x as d,y as u,z as i,au as k,X as h,A as F,D as t,B as l,Y as m,F as N,a0 as b,_,Q as v,Z as V,C as E,$ as Q,ax as I}from"./index.0d4fdb09.js";import{Q as C}from"./QSeparator.d36ff4c0.js";import{Q as x}from"./QInput.bef99052.js";import{Q as O}from"./QImg.d88c2cdb.js";import{Q as S}from"./QRadio.4058e9ee.js";import{Q as $}from"./QCard.08b29dcf.js";import{Q as J}from"./QForm.ddf020d2.js";import{Q as L}from"./QPage.ba57bee6.js";import"./QList.1bf52696.js";import"./use-dark.60ffaa8c.js";import"./rtl.4b414a6d.js";import"./scroll.9caef855.js";import"./use-key-composition.43e9e573.js";import"./uid.42677368.js";import"./use-form.299f2ee0.js";import"./QChip.3ce772c0.js";import"./QItem.b179d4fb.js";import"./use-fullscreen.6d8fb160.js";import"./use-model-toggle.6de98c5b.js";import"./QDialog.e412d48d.js";import"./use-timeout.dfa2929f.js";import"./QCheckbox.827ae7d1.js";import"./option-sizes.76e9a136.js";const M={class:"container"},R={class:"row q-mt-xl"},X={class:"col-2"},Y=t("div",{class:"text-h6"},"\u5F8C\u53F0\u7BA1\u7406",-1),Z=t("div",{class:"text-subtitle1 q-my-lg"},"\u4F7F\u7528\u8005\u7BA1\u7406",-1),j=t("div",{class:"text-subtitle1 q-my-lg"},"\u5546\u54C1\u7BA1\u7406",-1),G=t("div",{class:"text-subtitle1 q-my-lg"},"\u5E97\u92EA\u7BA1\u7406",-1),H=t("div",{class:"text-subtitle1 q-my-lg"},"\u8A02\u55AE\u7BA1\u7406",-1),K=t("div",{class:"text-subtitle1 q-my-lg"},"\u6D3B\u52D5\u7BA1\u7406",-1),W=t("div",{class:"text-subtitle1 q-my-lg"},"\u767B\u51FA",-1),ee={class:"col-10"},te={class:"flex items-center text-center q-mb-lg"},se={key:0,class:"text-h4 text-weight-medium"},le={key:1,class:"text-h4 text-weight-medium"},oe=t("div",{class:"text-body1 q-mb-md"},"\u7BA1\u7406\u8A02\u55AE\u9801\u9762",-1),ae={key:0},ie={key:1},de={class:"column"},re=b("\u4FEE\u6539"),ne=b("\u522A\u9664"),ce=t("div",{class:"text-h5"},"\u914D\u9001\u8A0A\u606F",-1),me={style:{"max-width":"400px"},class:"q-mb-xl"},ue=t("div",{class:"text-subtitle1 text-weight-medium"},"\u53D6\u8CA8\u4EBA\u540D\u5B57:",-1),_e=t("div",{class:"text-subtitle1 text-weight-medium"},"\u53D6\u8CA8\u4EBA\u96FB\u8A71:",-1),pe=t("div",{class:"text-subtitle1 text-weight-medium"},"\u53D6\u8CA8\u4EBA\u5730\u5740:",-1),ge=t("div",{class:"text-subtitle1 text-weight-medium"},"\u53D6\u8CA8\u4EBA\u4FE1\u7BB1:",-1),he=t("div",{class:"text-h5"},"\u5546\u54C1\u8CC7\u8A0A",-1),xe={class:"row"},be={class:"col-8 q-ml-md"},fe={class:"row items-center text-subtitle2 text-weight-medium"},ve=b(" \u5546\u54C1\u984F\u8272: "),ye={class:"text-subtitle2 text-weight-medium"},qe=t("div",{class:"text-subtitle2 text-weight-medium"},"\u6578\u91CF:",-1),we={style:{"max-width":"400px"}},ke={class:"col column reverse"},Ve={class:"row reverse"},Qe={class:"text-subtitle2 text-weight-medium q-mr-md"},Ce={class:"q-my-xxl"},tt={__name:"OrderAdmin",setup(Ue){const c=w([]),z=[{name:"date",align:"left",label:"\u8A02\u55AE\u65E5\u671F",field:"date"},{name:"_id",align:"left",label:"\u8A02\u55AE\u7DE8\u865F",field:"_id"},{name:"userid",align:"left",label:"\u8A02\u8CFC\u4EBA\u7DE8\u865F",field:"userid"},{name:"totalPrice",align:"left",label:"\u7E3D\u50F9\u9322",field:"totalPrice"},{name:"edit",label:"",align:"left",field:"edit"}],o=w({_id:"",date:"",getname:"",getaddress:"",getemail:"",getphone:"",products:[]}),p=P(!1),A=(a,s)=>{o._id=c[s]._id,o.getname=c[s].getname,o.getaddress=c[s].getaddress,o.getemail=c[s].getemail,o.getphone=c[s].getphone,o.products.splice(0,o.products.length),o.products.push(...JSON.parse(JSON.stringify(c[s].products))),p.value=!0},g=w({required(a){return!!a||"\u5FC5\u586B"},price(a){return a>-1||"\u5FC5\u9808\u5927\u65BC\u7B49\u65BC 0"},size(a){var s,r,e;return!a||!a.length||((r=(s=a[0])==null?void 0:s.type)==null?void 0:r.includes("image"))&&((e=a[0])==null?void 0:e.size)<1024*1024||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),B=async a=>{try{await k.delete("/orders/"+a),await h.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6210\u529F"})}catch(s){h.fire({icon:"error",title:"\u5931\u6557",text:s.isAxiosError&&s.response.data?s.response.data.message:"\u767C\u751F\u932F\u8AA4"})}},T=async()=>{try{const{data:a}=await k.patch("/orders/"+o._id,o);h.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),o.dialog=!1}catch(a){h.fire({icon:"success",title:"\u5931\u6557",text:a.isAxiosError?a.response.data.message:a.message})}o.submitting=!1};return(async()=>{try{const{data:a}=await k.get("/orders/all");c.push(...a.result.map(s=>(s.totalPrice=s.products.reduce((r,e)=>r+e.product.price*e.quantity,0),s)))}catch{h.fire({icon:"error",title:"\u5931\u6557",text:"\u7121\u6CD5\u53D6\u5F97\u8A02\u55AE"})}})(),(a,s)=>{const r=F("router-link");return d(),u(L,null,{default:i(()=>[t("section",M,[t("div",R,[t("div",X,[Y,l(r,{to:"/admin/user"},{default:i(()=>[Z]),_:1}),l(r,{to:"/admin/product"},{default:i(()=>[j]),_:1}),l(r,{to:"/admin/store"},{default:i(()=>[G]),_:1}),l(r,{to:"/admin/order"},{default:i(()=>[H]),_:1}),K,W]),t("div",ee,[t("div",te,[p.value?N("",!0):(d(),m("div",se,"\u8A02\u55AE\u7BA1\u7406")),p.value?(d(),m("div",le,"\u4FEE\u6539\u8A02\u55AE")):N("",!0),l(U)]),oe,p.value?(d(),u($,{key:1,flat:"",bordered:""},{default:i(()=>[l(J,{onSubmit:I(T,["prevent"]),class:"q-pa-md"},{default:i(()=>[ce,l(C,{class:"q-my-md"}),t("div",me,[ue,l(x,{modelValue:o.getname,"onUpdate:modelValue":s[0]||(s[0]=e=>o.getname=e),rules:[g.required],color:"black"},null,8,["modelValue","rules"]),_e,l(x,{modelValue:o.getphone,"onUpdate:modelValue":s[1]||(s[1]=e=>o.getphone=e),rules:[g.required],color:"black"},null,8,["modelValue","rules"]),pe,l(x,{modelValue:o.getaddress,"onUpdate:modelValue":s[2]||(s[2]=e=>o.getaddress=e),rules:[g.required],color:"black"},null,8,["modelValue","rules"]),ge,l(x,{modelValue:o.getemail,"onUpdate:modelValue":s[3]||(s[3]=e=>o.getemail=e),rules:[g.required],color:"black"},null,8,["modelValue","rules"])]),he,l(C,{class:"q-my-md"}),(d(!0),m(Q,null,V(o.products,e=>(d(),u($,{flat:"",key:e._id},{default:i(()=>[t("div",xe,[l(O,{class:"col-2",src:e.product.image[0]},null,8,["src"]),t("div",be,[t("div",fe,[ve,l(E,{color:e.color,size:"xs",class:"q-ml-xs"},null,8,["color"])]),(d(!0),m(Q,null,V(e.product.color,(n,y)=>(d(),u(S,{class:"q-my-md",color:"black",modelValue:e.color,"onUpdate:modelValue":q=>e.color=q,val:n,label:n,key:y},null,8,["modelValue","onUpdate:modelValue","val","label"]))),128)),t("div",ye,"\u5546\u54C1\u5C3A\u5BF8: "+_(e.size),1),(d(!0),m(Q,null,V(e.product.size,(n,y)=>(d(),u(S,{class:"q-my-md",color:"black",modelValue:e.size,"onUpdate:modelValue":q=>e.size=q,val:n,label:n,key:y},null,8,["modelValue","onUpdate:modelValue","val","label"]))),128)),qe,t("div",we,[l(x,{modelValue:e.quantity,"onUpdate:modelValue":n=>e.quantity=n,rules:[g.required],color:"black"},null,8,["modelValue","onUpdate:modelValue","rules"])])]),l(U),t("div",ke,[t("div",Ve,[t("div",Qe,"NT$:"+_(e.product.price*e.quantity),1)])])]),l(C,{class:"q-my-md"})]),_:2},1024))),128)),t("div",Ce,[l(v,{outline:"",class:"q-py-sm q-px-xxl text-subtitle2 q-mr-md",color:"black",label:"\u53D6\u6D88",onClick:s[4]||(s[4]=e=>p.value=!1),disabled:o.submitting},null,8,["disabled"]),l(v,{unelevated:"",class:"q-py-sm q-px-xxl text-subtitle2",type:"submit",color:"black text-white",label:"\u78BA\u5B9A"})])]),_:1},8,["onSubmit"])]),_:1})):(d(),u(D,{key:0,grid:a.$q.screen.xs,flat:"",bordered:"",rows:c,columns:z,"row-key":"name"},{"body-cell-date":i(e=>[l(f,{date:e},{default:i(()=>[b(_(new Date(e.row.date).toLocaleDateString()),1)]),_:2},1032,["date"])]),"body-cell-userid":i(e=>[l(f,{userid:e},{default:i(()=>[b(_(e.row.user._id),1)]),_:2},1032,["userid"])]),"body-cell-totalPrice":i(e=>[l(f,{date:e},{default:i(()=>[e.row.totalPrice<1500?(d(),m("span",ae,"NT$ "+_(e.row.totalPrice+80),1)):(d(),m("span",ie,"NT$ "+_(e.row.totalPrice),1))]),_:2},1032,["date"])]),"body-cell-edit":i(e=>[l(f,{edit:e},{default:i(()=>[t("div",de,[l(v,{class:"q-mb-sm q-px-lg",outline:"",onClick:n=>A(e.row._id,e.rowIndex)},{default:i(()=>[re]),_:2},1032,["onClick"]),l(v,{outline:"",onClick:n=>B(e.row._id)},{default:i(()=>[ne]),_:2},1032,["onClick"])])]),_:2},1032,["edit"])]),_:1},8,["grid","rows"]))])])])]),_:1})}}};export{tt as default};
