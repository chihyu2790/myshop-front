import{Q as N}from"./QSpace.c72392b0.js";import{a as E,Q as f}from"./QTable.d7d83021.js";import{N as J,F as k,r as L,P as O,H as r,I as _,J as i,ay as V,aj as h,S as s,K as l,T,V as m,U as $,L as b,M as p,Q as v,W as Q,R as M,X as U,aB as R}from"./index.34a9c747.js";import{Q as S}from"./QSeparator.a5f1724a.js";import{Q as x}from"./QInput.cf5fb9e5.js";import{Q as j}from"./QImg.f9af7805.js";import{Q as z}from"./QRadio.8510f6e2.js";import{Q as B}from"./QCard.f4c18fa6.js";import{Q as H}from"./QForm.c3dd6ee1.js";import{Q as K}from"./QPage.68bd7ebf.js";import"./QList.de9cd9a4.js";import"./use-dark.cd2d25a8.js";import"./rtl.4b414a6d.js";import"./use-prevent-scroll.364da34e.js";import"./focus-manager.d6507951.js";import"./use-key-composition.425bb1da.js";import"./format.2a3572e1.js";import"./uid.42677368.js";import"./QChip.0bcd8414.js";import"./QMenu.47fdb5c5.js";import"./selection.b742a580.js";import"./use-model-toggle.6d104167.js";import"./use-timeout.4257f6cd.js";import"./QDialog.6775a1c8.js";import"./use-form.2d350bda.js";import"./QCheckbox.5684b526.js";import"./option-sizes.c5d296bb.js";import"./use-fullscreen.bb765d3d.js";const W={class:"container"},X={class:"row q-mt-xl"},G={class:"col-2"},Y=s("div",{class:"text-h6"},"\u5F8C\u53F0\u7BA1\u7406",-1),Z=s("div",{class:"text-subtitle1 q-my-lg"},"\u4F7F\u7528\u8005\u7BA1\u7406",-1),ee=s("div",{class:"text-subtitle1 q-my-lg"},"\u5546\u54C1\u7BA1\u7406",-1),te=s("div",{class:"text-subtitle1 q-my-lg"},"\u5E97\u92EA\u7BA1\u7406",-1),se=s("div",{class:"text-subtitle1 q-my-lg"},"\u8A02\u55AE\u7BA1\u7406",-1),le={class:"col-10"},oe={class:"flex items-center text-center q-mb-lg"},ae={key:0,class:"text-h4 text-weight-medium"},ie={key:1,class:"text-h4 text-weight-medium"},re=s("div",{class:"text-body1 q-mb-md"},"\u7BA1\u7406\u8A02\u55AE\u9801\u9762",-1),de={key:0},ne={key:1},ce={class:"column"},me=b("\u4FEE\u6539"),ue=b("\u522A\u9664"),_e=s("div",{class:"text-h5"},"\u914D\u9001\u8A0A\u606F",-1),pe={style:{"max-width":"400px"},class:"q-mb-xl"},ge=s("div",{class:"text-subtitle1 text-weight-medium"},"\u53D6\u8CA8\u4EBA\u540D\u5B57:",-1),he=s("div",{class:"text-subtitle1 text-weight-medium"},"\u53D6\u8CA8\u4EBA\u96FB\u8A71:",-1),xe=s("div",{class:"text-subtitle1 text-weight-medium"},"\u53D6\u8CA8\u4EBA\u5730\u5740:",-1),be=s("div",{class:"text-subtitle1 text-weight-medium"},"\u53D6\u8CA8\u4EBA\u4FE1\u7BB1:",-1),fe=s("div",{class:"text-h5"},"\u5546\u54C1\u8CC7\u8A0A",-1),ve={class:"row"},ye={class:"col-8 q-ml-md"},qe={class:"row items-center text-subtitle2 text-weight-medium"},we=b(" \u5546\u54C1\u984F\u8272: "),ke={class:"text-subtitle2 text-weight-medium"},Ve=s("div",{class:"text-subtitle2 text-weight-medium"},"\u6578\u91CF:",-1),Qe={style:{"max-width":"400px"}},Ue={class:"col column reverse"},Se={class:"row reverse"},Ce={class:"text-subtitle2 text-weight-medium q-mr-md"},Ne={class:"q-my-xxl"},it={__name:"OrderAdmin",setup(Te){const P=J(),{logout:C}=P,d=k([]),A=[{name:"date",align:"left",label:"\u8A02\u55AE\u65E5\u671F",field:"date"},{name:"_id",align:"left",label:"\u8A02\u55AE\u7DE8\u865F",field:"_id"},{name:"userid",align:"left",label:"\u8A02\u8CFC\u4EBA\u7DE8\u865F",field:"userid"},{name:"totalPrice",align:"left",label:"\u7E3D\u50F9\u9322",field:"totalPrice"},{name:"edit",label:"",align:"left",field:"edit"}],o=k({_id:"",date:"",getname:"",getaddress:"",getemail:"",getphone:"",products:[]}),u=L(!1),D=(a,t)=>{o._id=d[t]._id,o.getname=d[t].getname,o.getaddress=d[t].getaddress,o.getemail=d[t].getemail,o.getphone=d[t].getphone,o.products.splice(0,o.products.length),o.products.push(...JSON.parse(JSON.stringify(d[t].products))),u.value=!0},g=k({required(a){return!!a||"\u5FC5\u586B"},price(a){return a>-1||"\u5FC5\u9808\u5927\u65BC\u7B49\u65BC 0"},size(a){var t,n,e;return!a||!a.length||((n=(t=a[0])==null?void 0:t.type)==null?void 0:n.includes("image"))&&((e=a[0])==null?void 0:e.size)<1024*1024||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),F=async a=>{try{await V.delete("/orders/"+a),await h.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6210\u529F"}),y()}catch(t){h.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError&&t.response.data?t.response.data.message:"\u767C\u751F\u932F\u8AA4"})}},I=async()=>{try{const{data:a}=await V.patch("/orders/"+o._id,o);h.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),y(),u.value=!1}catch(a){h.fire({icon:"success",title:"\u5931\u6557",text:a.isAxiosError?a.response.data.message:a.message})}o.submitting=!1},y=async()=>{try{const{data:a}=await V.get("/orders/all");d.splice(0,d.length),d.push(...a.result.map(t=>(t.totalPrice=t.products.reduce((n,e)=>n+e.product.price*e.quantity,0),t)))}catch{h.fire({icon:"error",title:"\u5931\u6557",text:"\u7121\u6CD5\u53D6\u5F97\u8A02\u55AE"})}};return y(),(a,t)=>{const n=O("router-link");return r(),_(K,null,{default:i(()=>[s("section",W,[s("div",X,[s("div",G,[Y,l(n,{to:"/admin/user"},{default:i(()=>[Z]),_:1}),l(n,{to:"/admin/product"},{default:i(()=>[ee]),_:1}),l(n,{to:"/admin/store"},{default:i(()=>[te]),_:1}),l(n,{to:"/admin/order"},{default:i(()=>[se]),_:1}),s("div",{class:"text-subtitle1 q-my-lg cursor-pointer",onClick:t[0]||(t[0]=(...e)=>T(C)&&T(C)(...e))},"\u767B\u51FA")]),s("div",le,[s("div",oe,[u.value?$("",!0):(r(),m("div",ae,"\u8A02\u55AE\u7BA1\u7406")),u.value?(r(),m("div",ie,"\u4FEE\u6539\u8A02\u55AE")):$("",!0),l(N)]),re,u.value?(r(),_(B,{key:1,flat:"",bordered:""},{default:i(()=>[l(H,{onSubmit:R(I,["prevent"]),class:"q-pa-md"},{default:i(()=>[_e,l(S,{class:"q-my-md"}),s("div",pe,[ge,l(x,{modelValue:o.getname,"onUpdate:modelValue":t[1]||(t[1]=e=>o.getname=e),rules:[g.required],color:"black"},null,8,["modelValue","rules"]),he,l(x,{modelValue:o.getphone,"onUpdate:modelValue":t[2]||(t[2]=e=>o.getphone=e),rules:[g.required],color:"black"},null,8,["modelValue","rules"]),xe,l(x,{modelValue:o.getaddress,"onUpdate:modelValue":t[3]||(t[3]=e=>o.getaddress=e),rules:[g.required],color:"black"},null,8,["modelValue","rules"]),be,l(x,{modelValue:o.getemail,"onUpdate:modelValue":t[4]||(t[4]=e=>o.getemail=e),rules:[g.required],color:"black"},null,8,["modelValue","rules"])]),fe,l(S,{class:"q-my-md"}),(r(!0),m(U,null,Q(o.products,e=>(r(),_(B,{flat:"",key:e._id},{default:i(()=>[s("div",ve,[l(j,{class:"col-2",src:e.product.image[0]},null,8,["src"]),s("div",ye,[s("div",qe,[we,l(M,{color:e.color,size:"xs",class:"q-ml-xs"},null,8,["color"])]),(r(!0),m(U,null,Q(e.product.color,(c,q)=>(r(),_(z,{class:"q-my-md",color:"black",modelValue:e.color,"onUpdate:modelValue":w=>e.color=w,val:c,label:c,key:q},null,8,["modelValue","onUpdate:modelValue","val","label"]))),128)),s("div",ke,"\u5546\u54C1\u5C3A\u5BF8: "+p(e.size),1),(r(!0),m(U,null,Q(e.product.size,(c,q)=>(r(),_(z,{class:"q-my-md",color:"black",modelValue:e.size,"onUpdate:modelValue":w=>e.size=w,val:c,label:c,key:q},null,8,["modelValue","onUpdate:modelValue","val","label"]))),128)),Ve,s("div",Qe,[l(x,{modelValue:e.quantity,"onUpdate:modelValue":c=>e.quantity=c,rules:[g.required],color:"black"},null,8,["modelValue","onUpdate:modelValue","rules"])])]),l(N),s("div",Ue,[s("div",Se,[s("div",Ce,"NT$:"+p(e.product.price*e.quantity),1)])])]),l(S,{class:"q-my-md"})]),_:2},1024))),128)),s("div",Ne,[l(v,{outline:"",class:"q-py-sm q-px-xxl text-subtitle2 q-mr-md",color:"black",label:"\u53D6\u6D88",onClick:t[5]||(t[5]=e=>u.value=!1),disabled:o.submitting},null,8,["disabled"]),l(v,{unelevated:"",class:"q-py-sm q-px-xxl text-subtitle2",type:"submit",color:"black text-white",label:"\u78BA\u5B9A"})])]),_:1},8,["onSubmit"])]),_:1})):(r(),_(E,{key:0,grid:a.$q.screen.xs,flat:"",bordered:"",rows:d,columns:A,"row-key":"name"},{"body-cell-date":i(e=>[l(f,{date:e},{default:i(()=>[b(p(new Date(e.row.date).toLocaleDateString()),1)]),_:2},1032,["date"])]),"body-cell-userid":i(e=>[l(f,{userid:e},{default:i(()=>[b(p(e.row.user._id),1)]),_:2},1032,["userid"])]),"body-cell-totalPrice":i(e=>[l(f,{date:e},{default:i(()=>[e.row.totalPrice<1500?(r(),m("span",de,"NT$ "+p(e.row.totalPrice+80),1)):(r(),m("span",ne,"NT$ "+p(e.row.totalPrice),1))]),_:2},1032,["date"])]),"body-cell-edit":i(e=>[l(f,{edit:e},{default:i(()=>[s("div",ce,[l(v,{class:"q-mb-sm q-px-lg",outline:"",onClick:c=>D(e.row._id,e.rowIndex)},{default:i(()=>[me]),_:2},1032,["onClick"]),l(v,{outline:"",onClick:c=>F(e.row._id)},{default:i(()=>[ue]),_:2},1032,["onClick"])])]),_:2},1032,["edit"])]),_:1},8,["grid","rows"]))])])])]),_:1})}}};export{it as default};
